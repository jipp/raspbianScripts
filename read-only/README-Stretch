installation:

configuration:
prepare image
cp config.txt config.txt.orig
cp cmdline.txt cmdline.txt.orig
sed -i s/" init=\/usr\/lib\/raspi-config\/init_resize.sh"// cmdline.txt

raspi-config

parition resize
parted /dev/mmcblk0 resizepart 2 8000M
resize2fs /dev/mmcblk0p2
blkid

partition create
parted mkpart primary 15630336s 100%
mkfs.ext4 /dev/mmcblk0p3

disable swap
systemctl stop dphys-swapfile
systemctl disable dphys-swapfile
dphys-swapfile swapoff
dphys-swapfile uninstall

fsck disable
sed -i s/" fsck.repair=yes"// cmdline.txt

fstab
mv /etc/fstab /etc/fstab.orig
cat fstab-Stretch > /etc/fstab

resolv
mv /etc/resolv.conf /etc/resolv.conf.orig
ln -s /var/tmp/resolv.conf /etc/resolv.conf

daily_lock
mv /var/lib/apt/daily_lock /var/lib/apt/daily_lock.orig
ln -s /var/tmp/daily_lock /var/lib/apt/daily_lock

cron
mv /etc/fake-hwclock.data /etc/fake-hwclock.data.orig
ln -s /var/tmp/hwclock.data /etc/fake-hwclock.data

rsyslog
touch /etc/rsyslog.d/DS416play.conf
patch -b /etc/rsyslog.d/DS416play.conf DS416play.conf.patch

aliases
patch -b /etc/bash.bashrc bash.bashrc.patch




create service:
touch /lib/systemd/system/setup-tmpfs.service
patch -b /lib/systemd/system/setup-tmpfs.service setup-tmpfs.service.patch
systemctl enable setup-tmpfs.service
mkdir /lib/systemd/scripts
touch /lib/systemd/scripts/setup-tmpfs.sh
patch -b /lib/systemd/scripts/setup-tmpfs.sh setup-tmpfs.sh.patch
chmod +x /lib/systemd/scripts/setup-tmpfs.sh

modify lighttpd:
mkdir /data/lighttpd
mv /var/www/html/esp /data/lighttpd/esp
chown -R www-data:www-data /data/lighttpd
ln -s /data/lighttpd/esp /var/www/html/esp

modify mosquitto:
mkdir /data/mosquitto
chown -R mosquitto:root /data/mosquitto
patch -b /etc/mosquitto/mosquitto.conf mosquitto.conf.patch

modify homegear:
patch -b /etc/homegear/main.conf main.conf.patch
patch -b /etc/homegear/php.ini php.ini.patch
patch -b /etc/homegear/homegear-start.sh homegear-start.sh.patch
mkdir -p /data/homegear/families
mkdir -p /data/homegear/db
mkdir -p /data/homegear/backup
mkdir -p /data/homegear/flows/data
chown homegear:homegear /data/homegear


enable/start:

backup:
